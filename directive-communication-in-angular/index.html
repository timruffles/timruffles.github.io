<!doctype html>
      <head>
        <title>Directive communication in Angular</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="/css/normalize.css" type="text/css">
        <link rel="stylesheet" href="/css/style.css" type="text/css">
        <link rel="stylesheet" href="/css/prism-ghcolors.css" type="text/css">
        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-24335480-1']);
          _gaq.push(['_trackPageview']);

          function asyncScript(src) {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = src;
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          }
          asyncScript(('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js');
        </script>
        <link rel="alternate" type="application/rss+xml" title="Subscribe to RSS feed" href="/rss.xml" />
      </head>
      <body class="article">
        <div id="mast">
          <div class='top-bar reading'>
              <div class="links logical">
                <div class="navigation logical">
                  <a href="/">Home</a>
                  <a href="https://feeds.feedburner.com/TimRufflesBlog">RSS</a>
                  <a href="/me">
                      Tim Ruffles
                  </a>
                </div>
              </div>
            </div>
        </div>
        <div id="content" class="reading">
           

           <div id="body">
              <h1><a href="/directive-communication-in-angular">Directive communication in Angular</a></h1>
  <p>Directives in Angular are great. One challenge people face, however, is getting them to interact without creating too much, or too little, coupling.</p>
<p>The route of high-coupling is via the <code>Scope</code>. However this means sharing a heap of mutable state between components. Worse still, if one directive needs to publish a function for another to use it&#39;s completely invisible in the template - and requires heavy setup in tests.</p>
<p>The low-coupling route is to use events (e.g <code>$rootScope.emit()</code>), or services. However both are best suited to very low-cohesion interactions as they are so implicit: they don&#39;t appear in the template and you have to read the source for both to see the publish/subscribe pairing.</p>
<p>For components that interact closely events or services therefore reduce the readability of your code, making it hard for others to see the interactions. <a href="https://www.python.org/dev/peps/pep-0020/" >Explicit is better than implicit</a>.</p>
<h2 id="the-controller-as-pattern-for-directives">The <code>controller-as</code> pattern for directives</h2>
<p>A pattern I really like is to define a <code>controller-as</code> attribute on directives to explicitly publish their public API. As an example, the following UI has a filter widget and a chart widget. The filter controls what data the graph shows. Their interaction is too direct for events or services to be a good choice:</p>
<img class="article-image" width="520" height="269" alt="angular directive communication via controller-as" src="/articles/interacting-directives/angular-directive-communication-via-controller-as.png">

<p>The HTML we want is something like this. You can see we have revealed the interactions between the components explicitly without any coupling:</p>
<pre><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> top level controller <span class="token operator">-</span> responsible <span class="token keyword">for</span> fetching data etc <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>div ng<span class="token operator">-</span>controller<span class="token operator">=</span><span class="token string">'DataVizCtrl as ctrl'</span><span class="token operator">></span>

  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> our filter widget has an on<span class="token operator">-</span>filtered event to 
       allow us to pass its filter to other directives <span class="token operator">--</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>filter<span class="token operator">-</span>widget
    on<span class="token operator">-</span>filtered<span class="token operator">=</span><span class="token string">'ctrl.graphCtrl.applyFilter($filter)'</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>filter<span class="token operator">-</span>widget<span class="token operator">></span>

  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> graph widget exposes its controller so we can
       use its API <span class="token keyword">in</span> our template <span class="token operator">--</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>graph<span class="token operator">-</span>widget
    controller<span class="token operator">-</span>as<span class="token operator">=</span><span class="token string">'ctrl.graphCtrl'</span>
    data<span class="token operator">=</span><span class="token string">'ctrl.data'</span>
    <span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>graph<span class="token operator">-</span>widget<span class="token operator">></span>

<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></code></pre>
<p>Now for the definitions of the directives - I&#39;ve kept them minimal to keep focussed.</p>
<p>The filter widget defines a <code>on-filtered=</code> event that is provided with a <code>$filter</code> variable. This will be a function usable in <code>Array.prototype.filter</code> etc - a function that takes a data item and decides whether it&#39;s included. This is a high level of abstraction over how that filter is constructed from the UI:</p>
<pre><code><span class="token keyword">function</span> <span class="token function">filterWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// minimal definition - this would have a template</span>
  <span class="token comment">// and more code in reality</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    scope<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      onFiltered<span class="token punctuation">:</span> <span class="token string">"&amp;"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    link<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// called from inside this directive's UI, we</span>
      <span class="token comment">// call the `onFiltered` expression exposing </span>
      <span class="token comment">// local `$filter` variable</span>
      scope<span class="token punctuation">.</span>publishFilter <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scope<span class="token punctuation">.</span><span class="token function">onFiltered</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          $filter<span class="token punctuation">:</span> <span class="token function">createFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// returns a filtering function</span>
      <span class="token keyword">function</span> <span class="token function">createFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>The graph widget exposes a controller with its public API via <code>controller-as=</code>. This allows it to be told about any desired modifications to the data (e.g a filter) and determine how to present them (i.e nice animations):</p>
<pre><code><span class="token keyword">function</span> <span class="token function">graphWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    scope<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      controllerAs<span class="token punctuation">:</span> <span class="token string">"ctrl"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>  
    controller<span class="token punctuation">:</span> GraphWidgetCtrl<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">GraphWidgetCtrl</span><span class="token punctuation">(</span>$scope<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $scope<span class="token punctuation">.</span>controllerAs <span class="token operator">=</span> this<span class="token punctuation">;</span>

  this<span class="token punctuation">.</span>applyFilter <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span>filteredData <span class="token operator">=</span> this<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>I find this pattern results in very readable interactions between components, with excellent testability. Hope you find it useful!</p>

  
            </div>
        </div>
        <div class="footer reading">
          <div class="container">
            <p>ðŸ“© helloï¼ timr Â· co</p>
          </div>
        </div>
      </body>